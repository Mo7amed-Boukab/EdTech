generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/*---------------------
   ENUMS
 ---------------------- */

enum Role {
  ADMIN
  TEACHER
  STUDENT
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
}

/*--------------------
   USER
 --------------------- */

model User {
  id        String   @id @default(uuid()) @db.Uuid
  fullName  String
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())

  /* -------- ADMIN -------- */
  classesCreated Class[] @relation("ClassCreatedBy")

  /* -------- TEACHER -------- */
  classesTeaching Class[]   @relation("ClassTeacher")
  subjectsTeaching Subject[]
  sessionsTeaching Session[]

  /* -------- STUDENT -------- */
  classId     String? @db.Uuid
  class       Class?  @relation("StudentClass", fields: [classId], references: [id])
  attendances Attendance[]
}

/* ---------------------
    CLASS
  ---------------------- */

model Class {
  id           String   @id @default(uuid()) @db.Uuid
  name         String
  level        String?  // 1ère, 2ème, 3ème, etc.
  academicYear String?  // 2024-2025, 2025-2026, etc.
  createdAt    DateTime @default(now())

  /* ADMIN who created the class */
  createdById String   @db.Uuid
  createdBy   User     @relation("ClassCreatedBy", fields: [createdById], references: [id])

  /* TEACHER assigned to the class */
  teacherId String?   @db.Uuid
  teacher   User?     @relation("ClassTeacher", fields: [teacherId], references: [id])

  /* STUDENTS */
  students  User[]   @relation("StudentClass")

  subjects  Subject[]
  sessions  Session[]
}

/*-------------------
    SUBJECT
  -------------------- */

model Subject {
  id   String @id @default(uuid()) @db.Uuid
  name String

  classId String? @db.Uuid
  class   Class?  @relation(fields: [classId], references: [id])

  teacherId String? @db.Uuid
  teacher   User?   @relation(fields: [teacherId], references: [id])

  sessions Session[]
}

/*--------------------
   SESSION
 -------------------- */

model Session {
  id        String   @id @default(uuid()) @db.Uuid
  date      DateTime

  classId String @db.Uuid
  class   Class  @relation(fields: [classId], references: [id])

  subjectId String  @db.Uuid
  subject   Subject @relation(fields: [subjectId], references: [id])

  teacherId String @db.Uuid
  teacher   User   @relation(fields: [teacherId], references: [id])

  attendances Attendance[]
}

/*--------------------
   ATTENDANCE
 --------------------- */

model Attendance {
  id     String @id @default(uuid()) @db.Uuid
  status AttendanceStatus

  sessionId String  @db.Uuid
  session   Session @relation(fields: [sessionId], references: [id])

  studentId String @db.Uuid
  student   User   @relation(fields: [studentId], references: [id])

  @@unique([sessionId, studentId])
}
